<!DOCTYPE html>
<html lang="sk">
<head>
Â Â Â  <meta charset="UTF-8">
Â Â Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
Â Â Â  <meta name="apple-mobile-web-app-capable" content="yes">
Â Â Â  <meta name="apple-mobile-web-app-status-bar-style" content="black">
Â Â Â  <title>KÃºkovskÃ© Bingo APP</title>
Â Â Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
Â Â Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
Â Â Â  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
Â Â Â  <style>
Â Â Â Â Â Â Â  :root { --main-color: #2c3e50; --win-color: #27ae60; --bg-color: #eef2f3; }
Â Â Â Â Â Â Â  body { font-family: 'Segoe UI', sans-serif; text-align: center; background: var(--bg-color); margin: 0; padding: 10px; -webkit-user-select: none; }
Â Â Â Â Â Â Â  #setup-screen { position: fixed; inset: 0; background: white; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
Â Â Â Â Â Â Â  .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; max-width: 500px; margin: auto; padding: 10px; }
Â Â Â Â Â Â Â  .cell { aspect-ratio: 1; border: 2px solid var(--main-color); background: white; display: flex; align-items: center; justify-content: center; font-size: 8px; cursor: pointer; position: relative; overflow: hidden; font-weight: bold; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
Â Â Â Â Â Â Â  .cell img { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
Â Â Â Â Â Â Â  .cell span { z-index: 2; background: rgba(255,255,255,0.8); padding: 2px 4px; border-radius: 3px; text-transform: uppercase; }
Â Â Â Â Â Â Â  .completed { border-color: var(--win-color); background: #d4edda; pointer-events: none; }
Â Â Â Â Â Â Â  #status { margin: 10px; padding: 12px; background: var(--main-color); color: white; border-radius: 8px; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
Â Â Â Â Â Â Â  #overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); color: #f1c40f; z-index: 200; align-items: center; justify-content: center; flex-direction: column; font-size: 40px; font-weight: bold; }
Â Â Â Â Â Â Â  input[type="text"] { padding: 12px; font-size: 16px; margin: 15px; border-radius: 8px; border: 2px solid #ddd; width: 80%; max-width: 300px; }
Â Â Â Â Â Â Â  button { padding: 12px 30px; font-size: 18px; background: var(--win-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
Â Â Â Â Â Â Â  button:disabled { background: #bdc3c7; cursor: not-allowed; }
Â Â Â  </style>
</head>
<body>

    <h1>ğŸ“ KÃºkovskÃ© Bingo</h1>
    <div class="subtitle">NÃ¡jdi predmety z mrieÅ¾ky v okolÃ­</div>

    <div id="setup">
        <input type="text" id="playerName" placeholder="Zadaj svoje meno...">
        <div id="loadingMsg" style="font-size: 12px; color: #999; margin-bottom: 10px;">Pripravujem AI...</div>
        <button id="startBtn" class="btn-start" disabled onclick="startGame()">ZAÄŒAÅ¤ HRU</button>
    </div>

    <div id="game" class="hidden">
        <div id="timer" style="text-align: center;">0:00</div>
        <div id="grid"></div>
        <p style="text-align: center; color: #999; font-size: 12px; margin-top: 20px;" onclick="location.reload()">ResetovaÅ¥ hru</p>
    </div>

    <div id="cameraOverlay">
        <div class="target-label">
            <small>AktuÃ¡lne hÄ¾adÃ¡Å¡:</small>
            <h2 id="targetName">Predmet</h2>
        </div>

        <div class="video-box">
            <video id="video" playsinline autoplay muted></video>
            <div class="scan-line"></div>
        </div>

        <div class="cam-ui">
            <div id="aiStatus">Zamier na predmet...</div>
            <div class="cam-btns">
                <button class="btn-capture" onclick="takePhoto()">ğŸ“¸ ANALYZOVAÅ¤</button>
                <button class="btn-close" onclick="closeCamera()">âœ•</button>
            </div>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

<script>
    const CONFIG = {
        emailjs_service: 'service_lgyn3eh',
        emailjs_template: 'template_3f2051q',
        emailjs_user: '6gKohTkcBCwR_zjq6'
    };

    const ITEMS = [
        { sk:'Kladivo', keywords:['hammer', 'mallet'] },
        { sk:'Visiaci zÃ¡mok', keywords:['padlock', 'lock'] },
        { sk:'KosaÄka', keywords:['lawn mower', 'mower', 'tractor'] },
        { sk:'MotorovÃ¡ pÃ­la', keywords:['chain saw', 'chainsaw'] },
        { sk:'Lopata', keywords:['shovel', 'spade'] },
        { sk:'FÃºrik', keywords:['wheelbarrow', 'barrow'] },
        { sk:'Traktor', keywords:['tractor', 'thresher'] },
        { sk:'Krhlina', keywords:['watering can', 'pitcher'] },
        { sk:'Vedro', keywords:['bucket', 'pail'] },
        { sk:'RebrÃ­k', keywords:['ladder', 'step ladder'] },
        { sk:'VlÄiak', keywords:['German shepherd', 'dog'] },
        { sk:'MaÄka', keywords:['cat', 'tabby'] },
        { sk:'Sliepka', keywords:['hen', 'rooster', 'chicken'] },
        { sk:'DrevenÃ½ plot', keywords:['picket fence', 'fence'] },
        { sk:'Poleno', keywords:['log', 'firewood', 'timber'] },
        { sk:'LaviÄka', keywords:['bench'] },
        { sk:'KvetinÃ¡Ä', keywords:['pot', 'flowerpot'] },
        { sk:'Sud', keywords:['barrel', 'drum'] },
        { sk:'Metla', keywords:['broom', 'mop'] },
        { sk:'Bicykel', keywords:['bicycle', 'bike'] },
        { sk:'Pneumatika', keywords:['tire', 'tyre', 'wheel'] },
        { sk:'Schody', keywords:['staircase', 'steps'] },
        { sk:'Hydrant', keywords:['fire hydrant', 'hydrant'] },
        { sk:'PoÅ¡tovÃ¡ schrÃ¡nka', keywords:['mailbox', 'postbox'] },
        { sk:'Smetiak', keywords:['trash can', 'garbage can'] }
    ];

    let model, gameState, videoStream, activeIdx;

    async function init() {
        emailjs.init(CONFIG.emailjs_user);
        model = await mobilenet.load();
        document.getElementById('loadingMsg').innerText = "âœ… AI PripravenÃ©";
        document.getElementById('startBtn').disabled = false;
    }

    function startGame() {
        const name = document.getElementById('playerName').value;
        if(!name) return alert("Zadaj meno!");

        gameState = {
            player: name,
            grid: [...ITEMS].sort(() => Math.random() - 0.5),
            found: [],
            startTime: Date.now()
        };

        document.getElementById('setup').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        renderGrid();
        startTimer();
    }

    function renderGrid() {
        const gridDiv = document.getElementById('grid');
        gridDiv.innerHTML = '';
        gameState.grid.forEach((item, i) => {
            const cell = document.createElement('div');
            cell.className = 'cell' + (gameState.found.includes(i) ? ' found' : '');
            if(gameState.found.includes(i)) {
                const imgData = localStorage.getItem(`photo_${gameState.player}_${i}`);
                cell.innerHTML = imgData ? `<img src="${imgData}">` : `<span>âœ…</span>`;
            } else {
                cell.innerHTML = `<span>${item.sk}</span>`;
                cell.onclick = () => openCamera(i);
            }
            gridDiv.appendChild(cell);
        });
    }

    async function openCamera(i) {
        activeIdx = i;
        document.getElementById('targetName').innerText = gameState.grid[i].sk;
        document.getElementById('cameraOverlay').style.display = 'flex';
        videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        document.getElementById('video').srcObject = videoStream;
    }

    async function takePhoto() {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        document.getElementById('aiStatus').innerText = "ğŸ” Analyzujem...";
        const predictions = await model.classify(canvas);
        
        const top = predictions[0];
        const percent = Math.round(top.probability * 100);
        document.getElementById('aiStatus').innerHTML = `AI vidÃ­: <b>${top.className}</b> (${percent}%)`;

        const item = gameState.grid[activeIdx];
        const match = predictions.some(p => 
            p.probability > 0.08 && item.keywords.some(k => p.className.toLowerCase().includes(k.toLowerCase()))
        );

        if(match) {
            document.getElementById('aiStatus').innerHTML = "<b style='color:#27ae60;'>ZHODA NÃJDENÃ!</b>";
            setTimeout(() => {
                localStorage.setItem(`photo_${gameState.player}_${activeIdx}`, canvas.toDataURL('image/jpeg', 0.5));
                gameState.found.push(activeIdx);
                closeCamera();
                renderGrid();
                checkWin();
            }, 800);
        }
    }

    function closeCamera() {
        if(videoStream) videoStream.getTracks().forEach(t => t.stop());
        document.getElementById('cameraOverlay').style.display = 'none';
        document.getElementById('aiStatus').innerText = "Zamier na predmet...";
    }

    function checkWin() {
        const lines = [[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]];
        if(lines.some(line => line.every(idx => gameState.found.includes(idx)))) {
            const time = document.getElementById('timer').innerText;
            alert(`BINGO! HrÃ¡Ä ${gameState.player} vyhral v Äase ${time}!`);
            emailjs.send(CONFIG.emailjs_service, CONFIG.emailjs_template, { player_name: gameState.player, finish_time: time });
        }
    }

    function startTimer() {
        setInterval(() => {
            const diff = Math.floor((Date.now() - gameState.startTime) / 1000);
            document.getElementById('timer').innerText = Math.floor(diff/60) + ":" + String(diff%60).padStart(2,'0');
        }, 1000);
    }

    init();
</script>
</body>
</html>
