<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dedinsk√© Bingo üéØ</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        :root {
            --primary: #27ae60;
            --accent: #f39c12;
            --dark: #1a2535;
            --bg: #f8f9fa;
        }

        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        /* Hlavn√Ω jednoduch√Ω ≈°t√Ωl */
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); width: 100%; max-width: 400px; text-align: center; margin-top: 20px; }
        input { width: 90%; padding: 12px; margin: 15px 0; border: 2px solid #eee; border-radius: 8px; font-size: 16px; }
        .btn-start { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; width: 100%; }
        
        /* Bingo mrie≈æka */
        #grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; max-width: 450px; margin-top: 20px; }
        .cell { aspect-ratio: 1; background: white; border: 1px solid #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: bold; text-align: center; cursor: pointer; position: relative; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cell.found { border: 2px solid var(--primary); background: #f0fff4; }
        .cell img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
        .cell span { z-index: 2; padding: 2px; background: rgba(255,255,255,0.7); border-radius: 3px; }

        /* --- CUSTOM FO≈§√ÅK (≈†t√Ωl od Claude) --- */
        #cameraOverlay { 
            position: fixed; inset: 0; background: var(--dark); z-index: 1000; 
            display: none; flex-direction: column; align-items: center; justify-content: space-between; 
            padding: 30px 20px; color: white;
        }
        .cam-header { text-align: center; width: 100%; }
        .target-box { background: rgba(255,255,255,0.1); border: 1px solid var(--accent); padding: 10px 20px; border-radius: 12px; margin-bottom: 20px; }
        .target-box span { font-size: 10px; text-transform: uppercase; color: #aaa; letter-spacing: 2px; }
        .target-box h2 { margin: 5px 0; color: var(--accent); font-size: 24px; }

        .video-container { position: relative; width: 100%; max-width: 350px; aspect-ratio: 1; border-radius: 20px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); }
        video { width: 100%; height: 100%; object-fit: cover; }
        .scan-line { position: absolute; width: 100%; height: 2px; background: var(--accent); top: 0; left: 0; box-shadow: 0 0 15px var(--accent); animation: scan 2s linear infinite; pointer-events: none; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        .cam-footer { width: 100%; display: flex; flex-direction: column; gap: 15px; align-items: center; }
        #aiStatus { font-size: 14px; color: #ddd; height: 20px; }
        .cam-btns { display: flex; gap: 15px; width: 100%; max-width: 350px; }
        .btn-capture { flex: 2; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(39,174,96,0.3); }
        .btn-close { flex: 1; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 15px; font-size: 18px; cursor: pointer; }

        #timer { font-size: 24px; font-weight: bold; color: var(--accent); margin: 10px; font-family: monospace; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <h1 style="color: var(--dark); margin-bottom: 0;">Dedinsk√© Bingo üéØ</h1>
    <p style="color: #666; margin-top: 5px;">N√°jdi predmety a vyhraj!</p>

    <div id="setup" class="card">
        <input type="text" id="playerName" placeholder="Tvoje meno...">
        <p id="loadingMsg" style="font-size: 13px; color: #888;">ü§ñ Pripravujem AI model...</p>
        <button id="startBtn" class="btn-start" disabled onclick="startGame()">ZAƒåA≈§ HRU</button>
    </div>

    <div id="game" class="hidden" style="text-align: center; width: 100%;">
        <div id="timer">0:00</div>
        <div id="grid"></div>
        <button onclick="location.reload()" style="background:none; border:none; color:#888; margin-top:30px; cursor:pointer; text-decoration:underline;">Re≈°tartova≈• hru</button>
    </div>

    <div id="cameraOverlay">
        <div class="cam-header">
            <div class="target-box">
                <span>Hƒæadan√Ω predmet</span>
                <h2 id="targetName">Predmet</h2>
            </div>
        </div>

        <div class="video-container">
            <video id="video" playsinline autoplay muted></video>
            <div class="scan-line"></div>
        </div>

        <div class="cam-footer">
            <p id="aiStatus">Namier na predmet a odfo≈•</p>
            <div class="cam-btns">
                <button class="btn-capture" onclick="takePhoto()">üì∏ ODFOTI≈§</button>
                <button class="btn-close" onclick="closeCamera()">‚úï</button>
            </div>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

<script>
    const CONFIG = {
        emailjs_service: 'service_lgyn3eh',
        emailjs_template: 'template_3f2051q',
        emailjs_user: '6gKohTkcBCwR_zjq6'
    };

    const ITEMS = [
        { sk:'Kladivo', keywords:['hammer', 'mallet'] },
        { sk:'Visiaci z√°mok', keywords:['padlock', 'lock'] },
        { sk:'Kosaƒçka', keywords:['lawn mower', 'mower', 'tractor'] },
        { sk:'Motorov√° p√≠la', keywords:['chain saw', 'chainsaw'] },
        { sk:'Lopata', keywords:['shovel', 'spade'] },
        { sk:'F√∫rik', keywords:['wheelbarrow', 'barrow'] },
        { sk:'Traktor', keywords:['tractor', 'thresher'] },
        { sk:'Krhlina', keywords:['watering can', 'pitcher'] },
        { sk:'Vedro', keywords:['bucket', 'pail'] },
        { sk:'Rebr√≠k', keywords:['ladder', 'step ladder'] },
        { sk:'Vlƒçiak', keywords:['German shepherd', 'dog'] },
        { sk:'Maƒçka', keywords:['cat', 'tabby'] },
        { sk:'Sliepka', keywords:['hen', 'rooster', 'chicken'] },
        { sk:'Dreven√Ω plot', keywords:['picket fence', 'fence'] },
        { sk:'Poleno', keywords:['log', 'firewood', 'timber'] },
        { sk:'Laviƒçka', keywords:['bench'] },
        { sk:'Kvetin√°ƒç', keywords:['pot', 'flowerpot'] },
        { sk:'Sud', keywords:['barrel', 'drum'] },
        { sk:'Metla', keywords:['broom', 'mop'] },
        { sk:'Bicykel', keywords:['bicycle', 'bike'] },
        { sk:'Pneumatika', keywords:['tire', 'tyre', 'wheel'] },
        { sk:'Schody', keywords:['staircase', 'steps'] },
        { sk:'Hydrant', keywords:['fire hydrant', 'hydrant'] },
        { sk:'Po≈°tov√° schr√°nka', keywords:['mailbox', 'postbox'] },
        { sk:'Smetiak', keywords:['trash can', 'garbage can'] }
    ];

    let model, gameState, videoStream, activeIdx;

    async function init() {
        emailjs.init(CONFIG.emailjs_user);
        model = await mobilenet.load();
        document.getElementById('loadingMsg').innerHTML = "‚úÖ AI je pripraven√©!";
        document.getElementById('startBtn').disabled = false;
    }

    function startGame() {
        const name = document.getElementById('playerName').value;
        if(!name) return alert("Zadaj meno!");

        alert("Rada: Fo≈• predmety zbl√≠zka a na dobrom svetle. Ak ich AI na prv√Ωkr√°t nepozn√°, sk√∫s in√Ω uhol.");

        gameState = {
            player: name,
            grid: [...ITEMS].sort(() => Math.random() - 0.5),
            found: [],
            startTime: Date.now()
        };

        document.getElementById('setup').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        renderGrid();
        startTimer();
    }

    function renderGrid() {
        const gridDiv = document.getElementById('grid');
        gridDiv.innerHTML = '';
        gameState.grid.forEach((item, i) => {
            const cell = document.createElement('div');
            cell.className = 'cell' + (gameState.found.includes(i) ? ' found' : '');
            
            if(gameState.found.includes(i)) {
                const imgData = localStorage.getItem(`photo_${gameState.player}_${i}`);
                cell.innerHTML = imgData ? `<img src="${imgData}">` : `<span>‚úÖ</span>`;
            } else {
                cell.innerHTML = `<span>${item.sk}</span>`;
                cell.onclick = () => openCamera(i);
            }
            gridDiv.appendChild(cell);
        });
    }

    async function openCamera(i) {
        activeIdx = i;
        document.getElementById('targetName').innerText = gameState.grid[i].sk;
        document.getElementById('cameraOverlay').style.display = 'flex';
        try {
            videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            document.getElementById('video').srcObject = videoStream;
        } catch(e) { alert("Chyba kamery."); }
    }

    async function takePhoto() {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        document.getElementById('aiStatus').innerText = "üîç AI analyzuje...";
        const predictions = await model.classify(canvas);
        const item = gameState.grid[activeIdx];

        const match = predictions.some(p => 
            p.probability > 0.1 && item.keywords.some(k => p.className.toLowerCase().includes(k))
        );

        if(match) {
            localStorage.setItem(`photo_${gameState.player}_${activeIdx}`, canvas.toDataURL('image/jpeg', 0.5));
            gameState.found.push(activeIdx);
            closeCamera();
            renderGrid();
            checkWin();
        } else {
            document.getElementById('aiStatus').innerText = "‚ùå AI vid√≠: " + predictions[0].className;
        }
    }

    function closeCamera() {
        if(videoStream) videoStream.getTracks().forEach(t => t.stop());
        document.getElementById('cameraOverlay').style.display = 'none';
        document.getElementById('aiStatus').innerText = "Namier na predmet a odfo≈•";
    }

    function checkWin() {
        const lines = [[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]];
        const bingo = lines.some(line => line.every(idx => gameState.found.includes(idx)));

        if(bingo) {
            const time = document.getElementById('timer').innerText;
            alert(`üéâ BINGO! Vyhral si v ƒçase ${time}!`);
            emailjs.send(CONFIG.emailjs_service, CONFIG.emailjs_template, {
                player_name: gameState.player,
                finish_time: time
            });
        }
    }

    function startTimer() {
        setInterval(() => {
            const diff = Math.floor((Date.now() - gameState.startTime) / 1000);
            document.getElementById('timer').innerText = Math.floor(diff/60) + ":" + String(diff%60).padStart(2,'0');
        }, 1000);
    }

    init();
</script>
</body>
</html>
