<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1a2535">
<title>K√∫kovsk√© Bingo üéØ</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
/* ... (ponechan√© Claudove CSS pre vizu√°l) ... */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --navy: #1a2535; --navy2: #1f2d3d; --glass: rgba(255,255,255,0.06);
  --glass2: rgba(255,255,255,0.11); --glass3: rgba(255,255,255,0.18);
  --border: rgba(255,255,255,0.10); --border2: rgba(255,255,255,0.18);
  --green: #27ae60; --green2: #2ecc71; --amber: #f39c12; --amber2: #f1c40f;
  --red: #e74c3c; --text: #ecf0f1; --text2: #bdc3c7; --muted: #7f8c8d;
  --radius: 12px; --radius2: 18px; --shadow: 0 8px 32px rgba(0,0,0,.45);
  --font-display:'Bebas Neue', sans-serif; --font-body:'Syne', sans-serif; --font-mono:'DM Mono', monospace;
}
html, body { height: 100%; width: 100%; background: var(--navy); color: var(--text); font-family: var(--font-body); overflow: hidden; overscroll-behavior: none; -webkit-tap-highlight-color: transparent; user-select: none; }
#bg { position: fixed; inset: 0; z-index: 0; overflow: hidden; pointer-events: none; }
#bg::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse 70% 50% at 15% 15%, rgba(39,174,96,.12) 0%, transparent 55%), radial-gradient(ellipse 50% 40% at 85% 75%, rgba(243,156,18,.08) 0%, transparent 55%), radial-gradient(ellipse 80% 80% at 50% 50%, var(--navy2) 0%, var(--navy) 100%); }
.screen { position: fixed; inset: 0; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; transition: opacity .45s, transform .45s; }
.screen.hidden { opacity: 0; pointer-events: none; transform: translateY(12px) scale(.98); }
#setup { gap: 22px; }
.logo { font-family: var(--font-display); font-size: clamp(52px, 18vw, 90px); line-height: .95; letter-spacing: 5px; background: linear-gradient(135deg, var(--amber) 0%, var(--amber2) 40%, var(--green2) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 30px rgba(243,156,18,.35)); text-align: center; }
.card { width: 100%; max-width: 380px; background: var(--glass2); backdrop-filter: blur(20px); border: 1px solid var(--border2); border-radius: var(--radius2); padding: 24px 20px; }
.card input { width: 100%; background: rgba(0,0,0,.25); border: 1.5px solid var(--border2); border-radius: var(--radius); padding: 13px 16px; color: var(--text); outline: none; }
.ai-loader { width: 100%; max-width: 380px; }
.progress-track { width: 100%; height: 5px; background: rgba(255,255,255,0.08); border-radius: 99px; overflow: hidden; }
.progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--amber), var(--green2)); transition: width .5s ease; }
.btn { width: 100%; max-width: 380px; padding: 16px 24px; border-radius: var(--radius2); font-family: var(--font-display); font-size: 22px; letter-spacing: 3px; cursor: pointer; transition: transform .15s; border:none; }
.btn-primary { background: linear-gradient(135deg, var(--amber) 0%, #e67e22 100%); color: #fff; }
.btn-secondary { background: var(--glass2); border: 1.5px solid var(--border2); color: var(--text); }
#game { justify-content: flex-start; padding: 0; }
#statusBar { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: rgba(15,22,32,.92); backdrop-filter: blur(16px); padding: 10px 16px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border); }
#grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; width: 100%; max-width: 360px; }
.cell { aspect-ratio: 1; background: var(--glass); border: 1.5px solid var(--border); border-radius: 10px; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; cursor: pointer; }
.cell-label { font-size: clamp(7px,2vw,9.5px); font-weight: 600; text-align: center; padding: 3px; white-space: pre-line; }
.cell.found { border-color: var(--green); }
.cell-photo { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
#cameraOverlay { position: fixed; inset: 0; z-index: 200; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 14px; }
#cameraOverlay.hidden { display: none; }
#videoPreview { width: 100%; max-width: 360px; aspect-ratio: 4/3; object-fit: cover; border-radius: var(--radius2); }
#victory { z-index: 300; background: rgba(10,16,26,.96); }
#toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: var(--glass3); padding: 12px 20px; border-radius: var(--radius); opacity: 0; transition: opacity .3s; pointer-events: none; z-index: 500; }
#toast.show { opacity: 1; }
</style>
</head>
<body>

<div id="bg"></div>

<div class="screen" id="setup">
  <div class="logo">K√öKOVSK√â<br>BINGO</div>
  <div class="card">
    <label style="font-size:11px; color:var(--muted); letter-spacing:2px; display:block; margin-bottom:5px;">MENO HR√ÅƒåA</label>
    <input type="text" id="playerName" placeholder="Zadaj meno..." maxlength="20">
  </div>
  <div class="ai-loader">
    <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:5px;">
      <span>ü§ñ Naƒç√≠tavam AI model</span>
      <span id="aiPercent">0%</span>
    </div>
    <div class="progress-track"><div class="progress-bar" id="aiProgress"></div></div>
  </div>
  <button class="btn btn-primary" id="startBtn" disabled onclick="handleStartBtn()">NAƒå√çTAVAM...</button>
  <button class="btn btn-secondary" id="continueBtn" style="display:none; margin-top:10px;" onclick="continueGame()">‚ñ∂ POKRAƒåOVA≈§</button>
</div>

<div class="screen hidden" id="game">
  <div id="statusBar">
    <span id="statusIcon">üéØ</span>
    <span id="statusText" style="font-size:12px; flex:1;">N√°jdi predmety v dedine</span>
    <span id="timerDisplay" style="color:var(--amber); font-family:var(--font-display); font-size:20px;">0:00</span>
  </div>
  <div style="margin-top:60px; width:100%; display:flex; flex-direction:column; align-items:center; gap:10px;">
    <div id="grid"></div>
  </div>
</div>

<div id="cameraOverlay" class="hidden">
  <video id="videoPreview" playsinline autoplay muted></video>
  <div style="text-align:center;">
    <div style="font-size:10px; color:var(--muted);">FOTOGRAFUJE≈†</div>
    <div id="camTargetName" style="font-family:var(--font-display); font-size:28px; color:var(--amber);">‚Äî</div>
  </div>
  <div style="display:flex; gap:10px; width:100%; max-width:360px;">
    <button class="btn" style="background:var(--green); color:#fff; flex:1;" id="captureBtn" onclick="capturePhoto()">üì∏ FOTI≈§</button>
    <button class="btn" style="background:var(--glass2); color:#fff; width:70px;" onclick="closeCamera()">‚úï</button>
  </div>
  <div id="camStatus" style="font-size:12px; color:var(--muted);">Namier a odfo≈•</div>
</div>
<canvas id="snapCanvas" style="display:none;"></canvas>

<div class="screen hidden" id="victory">
  <div style="font-size:40px;">üéâ üéâ üéâ</div>
  <div style="font-family:var(--font-display); font-size:80px; color:var(--amber);">BINGO!</div>
  <div id="victoryName" style="font-size:24px;">‚Äî</div>
  <div id="victoryTime" style="font-size:40px; margin:10px 0;">0:00</div>
  <div id="victoryEmailStatus" style="font-size:12px; color:var(--muted);">Odosielam v√Ωsledok...</div>
  <button class="btn btn-primary" onclick="resetGame()">HRA≈§ ZNOVA</button>
</div>

<div id="toast"></div>

<script>
const CONFIG = {
  emailjs_public_key: '6gKohTkcBCwR_zjq6',
  emailjs_service_id: 'service_lgyn3eh',
  emailjs_template_id: 'template_3f2051q',
  threshold: 0.10
};

/* MOJE UPRAVEN√â OBJEKTY S AI KƒΩ√öƒåOV√ùMI SLOVAMI */
const ALL_ITEMS = [
  { sk:'Kladivo', emoji:'üî®', keywords:['hammer', 'mallet'] },
  { sk:'Visiaci z√°mok', emoji:'üîí', keywords:['padlock', 'lock', 'combination lock'] },
  { sk:'Kosaƒçka', emoji:'üöú', keywords:['lawn mower', 'mower', 'tractor'] },
  { sk:'Motorov√° p√≠la', emoji:'ü™ö', keywords:['chain saw', 'chainsaw', 'power saw'] },
  { sk:'Lopata', emoji:'ü•Ñ', keywords:['shovel', 'spade', 'scoop', 'hoe'] },
  { sk:'F√∫rik', emoji:'üõí', keywords:['wheelbarrow', 'barrow', 'garden cart'] },
  { sk:'Traktor', emoji:'üöú', keywords:['tractor', 'thresher', 'farm machine', 'harvester'] },
  { sk:'Krhlina', emoji:'üöø', keywords:['watering can', 'water pot', 'pitcher'] },
  { sk:'Vedro', emoji:'ü™£', keywords:['bucket', 'pail', 'barrel', 'tub'] },
  { sk:'Rebr√≠k', emoji:'ü™ú', keywords:['ladder', 'step ladder', 'fire escape'] },
  { sk:'Vlƒçiak', emoji:'üêï', keywords:['German shepherd', 'German shepherd dog', 'police dog', 'dog', 'alsatian'] },
  { sk:'Maƒçka', emoji:'üê±', keywords:['tabby', 'tiger cat', 'cat', 'kitten'] },
  { sk:'Sliepka', emoji:'üêî', keywords:['hen', 'cock', 'rooster', 'chicken', 'fowl'] },
  { sk:'Dreven√Ω plot', emoji:'ü™µ', keywords:['picket fence', 'worm fence', 'rail fence', 'fence'] },
  { sk:'Poleno / Drevo', emoji:'ü™µ', keywords:['log', 'firewood', 'timber', 'lumber'] },
  { sk:'Laviƒçka', emoji:'ü™ë', keywords:['park bench', 'bench', 'seat'] },
  { sk:'Kvetin√°ƒç', emoji:'ü™¥', keywords:['pot', 'flowerpot', 'vase'] },
  { sk:'Sud', emoji:'üõ¢Ô∏è', keywords:['barrel', 'cask', 'water barrel', 'drum'] },
  { sk:'Metla', emoji:'üßπ', keywords:['broom', 'mop', 'swab'] },
  { sk:'Bicykel', emoji:'üö≤', keywords:['bicycle-built-for-two', 'tandem bicycle', 'mountain bike', 'bike', 'bicycle'] },
  { sk:'Pneumatika', emoji:'‚≠ï', keywords:['tire', 'tyre', 'car wheel', 'wheel'] },
  { sk:'Schody', emoji:'ü™ú', keywords:['staircase', 'stairway', 'steps'] },
  { sk:'Hydrant', emoji:'üö®', keywords:['fire hydrant', 'fireplug', 'hydrant'] },
  { sk:'Po≈°tov√° schr√°nka', emoji:'üì¨', keywords:['mailbox', 'letterbox', 'mail slot'] },
  { sk:'Smetiak', emoji:'üóëÔ∏è', keywords:['trash can', 'garbage can', 'wastebin', 'ashcan', 'recycling bin'] }
];

let model, gameState, timerHandle, videoStream, activeCellIdx;

async function initApp() {
  emailjs.init(CONFIG.emailjs_public_key);
  const saved = JSON.parse(localStorage.getItem('kukovske_bingo_save'));
  if(saved) document.getElementById('continueBtn').style.display = 'block';

  try {
    model = await mobilenet.load({ version: 2, alpha: 1.0 });
    document.getElementById('aiProgress').style.width = '100%';
    document.getElementById('aiPercent').textContent = '100%';
    document.getElementById('startBtn').disabled = false;
    document.getElementById('startBtn').textContent = '‚ñ∂ ZAƒåA≈§ HRU';
  } catch(e) { alert("Chyba AI. Sk√∫s refresh."); }
}

function handleStartBtn() {
  const name = document.getElementById('playerName').value.trim();
  if(!name) { alert("Zadaj meno!"); return; }
  
  // TEN D√îLE≈ΩIT√ù ALERT
  alert("Rada pre hr√°ƒça:\n\nKeƒè fot√≠≈° predmet, sna≈æ sa, aby bol dobre osvetlen√Ω, v strede z√°beru a neh√Ωb sa, k√Ωm AI analyzuje fotku. Ak ho AI na prv√Ωkr√°t nepozn√°, sk√∫s zmeni≈• uhol!");
  
  const shuffled = [...ALL_ITEMS].sort(() => Math.random() - 0.5);
  gameState = { player: name, grid: shuffled, found: [], startTime: Date.now() };
  saveAndStart();
}

function saveAndStart() {
  showScreen('game');
  renderBoard();
  startTimer();
}

function renderBoard() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  gameState.grid.forEach((item, idx) => {
    const cell = document.createElement('div');
    cell.className = 'cell' + (gameState.found.includes(idx) ? ' found' : '');
    if(gameState.found.includes(idx)) {
      const img = document.createElement('img');
      img.className = 'cell-photo';
      img.src = localStorage.getItem(`photo_${gameState.player}_${idx}`);
      cell.appendChild(img);
    } else {
      cell.innerHTML = `<div class="cell-label">${item.emoji}\n${item.sk}</div>`;
      cell.onclick = () => openCamera(idx);
    }
    grid.appendChild(cell);
  });
}

async function openCamera(idx) {
  activeCellIdx = idx;
  document.getElementById('camTargetName').textContent = gameState.grid[idx].sk;
  document.getElementById('cameraOverlay').classList.remove('hidden');
  videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
  document.getElementById('videoPreview').srcObject = videoStream;
}

function closeCamera() {
  if(videoStream) videoStream.getTracks().forEach(t => t.stop());
  document.getElementById('cameraOverlay').classList.add('hidden');
}

async function capturePhoto() {
  const video = document.getElementById('videoPreview');
  const canvas = document.getElementById('snapCanvas');
  canvas.width = video.videoWidth; canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  
  document.getElementById('camStatus').textContent = "üîç AI sk√∫ma...";
  const preds = await model.classify(canvas);
  const item = gameState.grid[activeCellIdx];
  
  const found = preds.some(p => p.probability >= CONFIG.threshold && item.keywords.some(k => p.className.toLowerCase().includes(k)));

  if(found) {
    const data = canvas.toDataURL('image/jpeg', 0.6);
    localStorage.setItem(`photo_${gameState.player}_${activeCellIdx}`, data);
    gameState.found.push(activeCellIdx);
    localStorage.setItem('kukovske_bingo_save', JSON.stringify(gameState));
    closeCamera();
    renderBoard();
    if(checkBingo()) victory();
  } else {
    document.getElementById('camStatus').textContent = "‚ùå AI vid√≠: " + preds[0].className;
    setTimeout(() => document.getElementById('camStatus').textContent = "Sk√∫s in√Ω uhol!", 2000);
  }
}

function checkBingo() {
  const lines = [[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]];
  return lines.some(l => l.every(i => gameState.found.includes(i)));
}

function victory() {
  const time = document.getElementById('timerDisplay').textContent;
  document.getElementById('victoryName').textContent = gameState.player;
  document.getElementById('victoryTime').textContent = time;
  showScreen('victory');
  emailjs.send(CONFIG.emailjs_service_id, CONFIG.emailjs_template_id, { player_name: gameState.player, finish_time: time });
}

function startTimer() {
  clearInterval(timerHandle);
  timerHandle = setInterval(() => {
    const sec = Math.floor((Date.now() - gameState.startTime) / 1000);
    document.getElementById('timerDisplay').textContent = Math.floor(sec/60) + ":" + String(sec%60).padStart(2,'0');
  }, 1000);
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function resetGame() { localStorage.removeItem('kukovske_bingo_save'); location.reload(); }

window.onload = initApp;
</script>
</body>
</html>
